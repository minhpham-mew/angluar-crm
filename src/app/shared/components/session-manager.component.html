<p-dialog 
  header="Session Management" 
  [visible]="isVisible" 
  [modal]="true" 
  [closable]="true"
  [style]="{ width: '50vw' }"
  [breakpoints]="{ '960px': '75vw', '641px': '90vw' }">
  
  <div class="space-y-4">
    <!-- Current Session Info -->
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex items-center">
          <i class="pi pi-desktop mr-2"></i>
          <span class="font-medium">Current Session</span>
        </div>
      </ng-template>
      
      @if (currentSession) {
        <div class="space-y-2">
          <div class="flex justify-between">
            <span class="text-sm text-gray-600">Device:</span>
            <span class="text-sm font-medium">{{ currentSession.clientName || 'Unknown Device' }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-sm text-gray-600">IP Address:</span>
            <span class="text-sm font-medium">{{ currentSession.ip || 'Unknown' }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-sm text-gray-600">Created:</span>
            <span class="text-sm font-medium">{{ currentSession.$createdAt | date:'medium' }}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-sm text-gray-600">Expires:</span>
            <span class="text-sm font-medium">{{ currentSession.expire | date:'medium' }}</span>
          </div>
        </div>
      } @else {
        <p class="text-sm text-gray-500">Loading session information...</p>
      }
    </p-card>

    <!-- All Sessions -->
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center">
            <i class="pi pi-list mr-2"></i>
            <span class="font-medium">All Active Sessions</span>
          </div>
          <p-button 
            icon="pi pi-refresh" 
            severity="secondary"
            [text]="true"
            size="small"
            (onClick)="loadSessions()"
            pTooltip="Refresh sessions">
          </p-button>
        </div>
      </ng-template>
      
      @if (allSessions && allSessions.sessions.length > 0) {
        <div class="space-y-3">
          @for (session of allSessions.sessions; track session.$id) {
            <div class="flex items-center justify-between p-3 border rounded-lg">
              <div class="flex-1">
                <div class="flex items-center space-x-2 mb-1">
                  <i class="pi pi-desktop text-blue-500"></i>
                  <span class="font-medium text-sm">{{ session.clientName || 'Unknown Device' }}</span>
                  @if (session.current) {
                    <p-tag value="Current" severity="success" size="small"></p-tag>
                  }
                </div>
                <div class="text-xs text-gray-500 space-y-1">
                  <div>IP: {{ session.ip || 'Unknown' }}</div>
                  <div>Created: {{ session.$createdAt | date:'short' }}</div>
                  <div>Expires: {{ session.expire | date:'short' }}</div>
                </div>
              </div>
              <div class="flex space-x-2">
                @if (!session.current) {
                  <p-button 
                    icon="pi pi-times" 
                    severity="danger"
                    [text]="true"
                    size="small"
                    (onClick)="deleteSession(session.$id)"
                    pTooltip="End this session">
                  </p-button>
                }
              </div>
            </div>
          }
        </div>
      } @else {
        <p class="text-sm text-gray-500">No active sessions found.</p>
      }
    </p-card>

    <!-- Session Actions -->
    <div class="flex justify-between pt-4">
      <p-button 
        label="Refresh Current Session"
        icon="pi pi-refresh"
        severity="secondary"
        (onClick)="refreshSession()">
      </p-button>
      
      <p-button 
        label="End All Other Sessions"
        icon="pi pi-sign-out"
        severity="danger"
        [outlined]="true"
        (onClick)="confirmEndAllSessions()">
      </p-button>
    </div>
  </div>
</p-dialog>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>
